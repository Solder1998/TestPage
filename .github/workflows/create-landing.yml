name: Create Landing via AI API

on:
  # üîπ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ GitHub UI (–æ—Å—Ç–∞–≤–ª—è–µ–º, –∫–∞–∫ —É —Ç–µ–±—è –±—ã–ª–æ)
  workflow_dispatch:
    inputs:
      url:
        description: "URL path (e.g. hello-test or lp/test-offer)"
        required: true
      title:
        description: "Landing title"
        required: true
      publish:
        description: "Publish immediately? true/false"
        required: false
        default: "false"

  # üîπ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ payload.json (Codex / merge / commit)
  push:
    paths:
      - payload.json

jobs:
  create:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # üîπ –ï—Å–ª–∏ workflow –∑–∞–ø—É—â–µ–Ω –≤—Ä—É—á–Ω—É—é ‚Äî —Å–æ–±–∏—Ä–∞–µ–º payload –∏–∑ input‚Äô–æ–≤
      - name: Build payload from inputs (manual run)
        if: github.event_name == 'workflow_dispatch'
        run: |
          PUBLISH=false
          if [ "${{ github.event.inputs.publish }}" = "true" ]; then
            PUBLISH=true
          fi

          cat << EOF > payload.json
          {
            "url": "${{ github.event.inputs.url }}",
            "title": "${{ github.event.inputs.title }}",
            "head": "<meta name=\"robots\" content=\"noindex,nofollow\">",
            "body": "<h1>${{ github.event.inputs.title }}</h1><p>–°–æ–∑–¥–∞–Ω–æ —á–µ—Ä–µ–∑ GitHub Actions</p>",
            "publish": $PUBLISH
          }
          EOF

      # üîπ –û—Ç–ø—Ä–∞–≤–∫–∞ payload.json –≤ WordPress (–∏ –¥–ª—è manual, –∏ –¥–ª—è Codex)
      - name: Send request to WordPress
        run: |
          echo "=== PAYLOAD ==="
          cat payload.json
          echo ""

          echo "=== RESPONSE ==="
          curl -i -L -X POST "${{ secrets.WP_API_URL }}" \
            -H "Content-Type: application/json" \
            -H "X-AI-TOKEN: ${{ secrets.WP_API_TOKEN }}" \
            --data @payload.json
