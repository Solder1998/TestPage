name: Create Landing via AI API

on:
  workflow_dispatch:
    inputs:
      url:
        description: "URL path (e.g. /lp/test-offer)"
        required: true
      title:
        description: "Landing title"
        required: true
      publish:
        description: "Publish immediately? true/false"
        required: false
        default: "false"

jobs:
  create:
    runs-on: ubuntu-latest

    steps:
      - name: Build payload
        run: |
          PUBLISH=false
          if [ "${{ github.event.inputs.publish }}" = "true" ]; then
            PUBLISH=true
          fi
      
          cat << EOF > payload.json
          {
            "url": "${{ github.event.inputs.url }}",
            "title": "${{ github.event.inputs.title }}",
            "head": "<meta name=\"robots\" content=\"noindex,nofollow\">",
            "body": "<h1>${{ github.event.inputs.title }}</h1><p>Создано через GitHub Actions</p>",
            "publish": $PUBLISH
          }
          EOF


      - name: Send request to WordPress
        run: |
          echo "=== PAYLOAD ==="
          cat payload.json
          echo ""
      
          echo "=== RESPONSE ==="
            curl -i -L -X POST "${{ secrets.WP_API_URL }}" \
              -H "Content-Type: application/json" \
              -H "X-AI-TOKEN: ${{ secrets.WP_API_TOKEN }}" \
              --data @payload.json
